{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\jeecg\\modules\\JeecgOrderMainModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\jeecg\\modules\\JeecgOrderMainModal.vue","mtime":1588673568194},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_thread-loader@2.1.3@thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { httpAction,getAction } from '@/api/manage'\nimport JDate from '@/components/jeecg/JDate'\nimport pick from 'lodash.pick'\nimport moment from \"moment\"\n\nexport default {\n  name: \"JeecgOrderMainModal\",\n  components: {\n    JDate\n  },\n  data () {\n    return {\n      title:\"操作\",\n      visible: false,\n      orderMainModel: {jeecgOrderCustomerList: [{}],\n                         jeecgOrderTicketList: [{}]},\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 },\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 },\n      },\n\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules:{\n      },\n      url: {\n        add: \"/test/jeecgOrderMain/add\",\n        edit: \"/test/jeecgOrderMain/edit\",\n        orderCustomerList: \"/test/jeecgOrderMain/queryOrderCustomerListByMainId\",\n        orderTicketList: \"/test/jeecgOrderMain/queryOrderTicketListByMainId\",\n      },\n    }\n  },\n  created () {\n  },\n  methods: {\n    add () {\n      this.edit({});\n    },\n    edit (record) {\n      this.form.resetFields();\n      this.orderMainModel = Object.assign({}, record);\n      this.orderMainModel.jeecgOrderCustomerList = [{}];\n      this.orderMainModel.jeecgOrderTicketList = [{}];\n      //--------------------------------------------------------\n      //初始化明细表数据\n      console.log(this.orderMainModel.id)\n      if(this.orderMainModel.id){\n        let params = {id:this.orderMainModel.id}\n        //初始化订单机票列表\n        getAction(this.url.orderCustomerList,params).then((res)=>{\n          if(res.success){\n            this.orderMainModel.jeecgOrderCustomerList = res.result;\n            this.$forceUpdate()\n          }\n        })\n        //初始化订单客户列表\n        getAction(this.url.orderTicketList,params).then((res)=>{\n          if(res.success){\n            this.orderMainModel.jeecgOrderTicketList = res.result;\n            this.$forceUpdate()\n          }\n        })\n      }\n      //--------------------------------------------------------\n      this.visible = true;\n      this.$nextTick(() => {\n        this.form.setFieldsValue(pick(this.orderMainModel,'orderCode','ctype','orderMoney','content'))\n        this.form.setFieldsValue({orderDate:this.orderMainModel.orderDate?moment(this.orderMainModel.orderDate):null}) //时间格式化\n      });\n      console.log(this.orderMainModel)\n    },\n    close () {\n      this.$emit('close');\n      this.visible = false;\n    },\n    handleOk () {\n      const that = this;\n      // 触发表单验证\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          that.confirmLoading = true;\n          let httpurl = '';\n          let method = '';\n          if(!this.orderMainModel.id){\n            httpurl+=this.url.add;\n            method = 'post';\n          }else{\n            httpurl+=this.url.edit;\n             method = 'put';\n          }\n          let orderMainData = Object.assign(this.orderMainModel, values);\n          //时间格式化\n          orderMainData.orderDate = orderMainData.orderDate?orderMainData.orderDate.format('YYYY-MM-DD HH:mm:ss'):null;\n          let formData = {\n            ...orderMainData,\n            jeecgOrderCustomerList: orderMainData.jeecgOrderCustomerList,\n            jeecgOrderTicketList: orderMainData.jeecgOrderTicketList\n          }\n\n          console.log(formData)\n          httpAction(httpurl,formData,method).then((res)=>{\n            if(res.success){\n              that.$message.success(res.message);\n              that.$emit('ok');\n            }else{\n              that.$message.warning(res.message);\n            }\n          }).finally(() => {\n            that.confirmLoading = false;\n            that.close();\n          })\n\n        }\n      })\n    },\n    handleCancel () {\n      this.close()\n    },\n    addRowCustom () {\n      this.orderMainModel.jeecgOrderCustomerList.push({});\n      this.$forceUpdate();\n    },\n    delRowCustom (index) {\n      console.log(index)\n      this.orderMainModel.jeecgOrderCustomerList.splice(index,1);\n      this.$forceUpdate();\n    },\n    addRowTicket () {\n      this.orderMainModel.jeecgOrderTicketList.push({});\n      console.log(this.orderMainModel.jeecgOrderTicketList)\n      this.$forceUpdate();\n    },\n    delRowTicket (index) {\n      console.log(index)\n      this.orderMainModel.jeecgOrderTicketList.splice(index,1);\n      this.$forceUpdate();\n    },\n\n\n  }\n}\n",null]}