{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\team\\modules\\BigTeamModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\team\\modules\\BigTeamModal.vue","mtime":1591693622135},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  import { httpAction, getAction} from '@/api/manage'\n  import Vue from 'vue'\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\";\n  import pick from 'lodash.pick'\n  import * as qiniu from 'qiniu-js'\n\n  export default {\n    name: \"BigTeamModal\",\n    data () {\n      return {\n        title:\"操作\",\n        visible: false,\n        headers: {},\n        loading: false,\n        coverimg: '',\n        canimg: '',\n        percent: '',\n        disableSubmit: false,\n\t\tautoSubmit: false,\n\t\tteamName: '',\n        model: {},\n        labelCol: {\n          xs: { span: 24 },\n          sm: { span: 5 },\n        },\n        wrapperCol: {\n          xs: { span: 24 },\n          sm: { span: 16 },\n        },\n        searchParam: '',    // 搜索字段\n        dataSource: [],     // 选择数据源\n        userId: null,\n        confirmLoading: false,\n        form: this.$form.createForm(this),\n        validatorRules:{\n        },\n        url: {\n          add: \"/system/bigteam/add\",\n          edit: \"/system/bigteam/edit\",\n          fileUpload: window._CONFIG['domianQiNiu'],\n          qiniuToken: '/qiniuUpToken',\n          searchUrl: '/system/appuserinfo/getUserBYPhoneOrCodeOrNickName'\n        },\n      }\n    },\n    computed:{\n      uploadAction:function () {\n        return this.url.fileUpload;\n      }\n    },\n    created () {\n      const token = Vue.ls.get(ACCESS_TOKEN);\n      this.headers = {\"X-Access-Token\":token};\n    },\n    methods: {\n      add () {\n        this.coverimg = '';\n\t\tthis.teamName = '';\n        this.edit({});\n      },\n      edit (record) {\n        console.log(record.name)\n\t\tif(record && record.name && record.name !== '' && record.name !== undefined) {\n\t\t\tthis.autoSubmit = true;\n\t\t\tconsole.log(this.autoSubmit)\n\t\t} else {\n\t\t\tthis.autoSubmit = false;\n\t\t\tconsole.log(this.autoSubmit);\n\t\t}\n\t\tthis.teamName = record.userName\n        this.coverimg = record.image;\n        this.canimg = record.image;\n        this.form.resetFields();\n        this.model = Object.assign({}, record);\n        this.visible = true;\n        this.$nextTick(() => {\n          this.form.setFieldsValue(pick(this.model,'name','image','userId','userName','teamNum','descr'))\n        });\n\n      },\n      close () {\n        this.$emit('close');\n        this.visible = false;\n        this.coverimg = '';\n        this.canimg = '';\n        this.percent = '';\n        this.dataSource = [];\n        this.searchParam = '';\n        this.disableSubmit = false;\n      },\n      handleOk () {\n        const that = this;\n        // 触发表单验证\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            that.confirmLoading = true;\n            let httpurl = '';\n            let method = '';\n            if(!this.model.id){\n              httpurl+=this.url.add;\n              method = 'post';\n            }else{\n              httpurl+=this.url.edit;\n               method = 'put';\n            }\n            let formData = Object.assign(this.model, values);\n               console.log('formData')\n          console.log(formData)\n            formData.image = this.coverimg;\n            formData.userId = this.userId;\n            //时间格式化\n            \n            console.log(formData)\n            httpAction(httpurl,formData,method).then((res)=>{\n              if(res.success){\n                that.$message.success(res.message);\n                that.$emit('ok');\n              }else{\n                that.$message.warning(res.message);\n              }\n            }).finally(() => {\n              that.confirmLoading = false;\n              that.close();\n            })\n\n\n\n          }\n        })\n      },\n      handleCancel () {\n        this.close()\n      },\n      // 自定义上传\n      customRequest (data) {\n        const suffix = \".\" + data.file.name.replace(/^.+\\./, '')\n        //请求token\n        httpAction(this.url.qiniuToken, {}, 'post').then((res) => {\n          if (res) {\n            let token = res.data.token\n            const file = data.file\n            const key = new Date().getTime() + suffix;\n            let domain = this.url.fileUpload\n            let config = {\n              useCdnDomain: true,\n              region: null\n            }\n            let putExtra = {\n              fname: '',\n              params: {},\n              mimeType: null\n            }\n            let observable = qiniu.upload(file, key, token, putExtra, config);\n            observable.subscribe({\n              next: (res) => {\n                this.loading = true;\n                this.percent = res.total.percent.toFixed(2)\n                this.coverimg = '';\n              },\n              error: () => {\n                this.$message.error('上传失败')\n                this.loading = false;\n                this.coverimg = this.canimg\n              },\n              complete: (response) => {\n                this.coverimg = `${domain}/${response.key}`;\n                this.loading = false;\n              }\n            })\n          }\n        })\n      },\n      //  输入选择框\n      onSelect (value) {\n        this.dataSource.forEach(item => {\n          if (item.nickName === value) {\n            this.userId = item.userId\n              console.log('this.userId')\n          console.log(this.userId)\n          }\n        })\n      },\n      handleSearch(value) {\n        console.log('search', value)\n        this.searchParam = value\n      },\n      //  开始搜索\n      beginSearch () {\n        getAction(this.url.searchUrl, {searchParam: this.searchParam}).then(res => {\n          console.log(res)\n          if (res.success) {\n            if (res.result.length === 0) {\n              this.$message.warning('暂无数据')\n            } else {\n              this.dataSource = res.result\n            }\n          } else {\n            this.$message.warning(res.message)\n          }\n        }).catch(err => {\n          this.$message.warning(err.message)\n        })\n      }\n    }\n  }\n",null]}