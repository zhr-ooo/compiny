{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\team\\modules\\BigTeamModal.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\team\\modules\\BigTeamModal.vue","mtime":1591693622135},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_css-loader@1.0.1@css-loader\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_postcss-loader@3.0.0@postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_less-loader@4.1.0@less-loader\\dist\\cjs.js","mtime":1591775899740},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.global-search .associate_input .ant-input-suffix {\n  right: 0 !important;\n}\n.global-search .ant-input-suffix .ant-btn-lg {\n  height: 32px;\n}\n.global-search .ant-input-affix-wrapper .ant-input:not(:last-child) {\n  padding: 0 50px 0 12px;\n}\n\n.global-search.ant-select-auto-complete .ant-input-affix-wrapper .ant-input-suffix button {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n.selece-option {\n  padding: 10px 10px;\n  display: flex;\n  align-items: center;\n}\n",{"version":3,"sources":["BigTeamModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"BigTeamModal.vue","sourceRoot":"src/views/team/modules","sourcesContent":["<template>\n  <a-modal\n    :title=\"title\"\n    :width=\"800\"\n    :visible=\"visible\"\n    :confirmLoading=\"confirmLoading\"\n    @ok=\"handleOk\"\n    @cancel=\"handleCancel\"\n    cancelText=\"关闭\">\n    \n    <a-spin :spinning=\"confirmLoading\">\n      <a-form :form=\"form\">\n      \n        <a-form-item\n          :labelCol=\"labelCol\"\n          :wrapperCol=\"wrapperCol\"\n          label=\"大V团名\">\n          <a-input placeholder=\"请输入大V团名\" v-decorator=\"['name', {rules: [{required: true, message: '请输入大V团名'}]}]\" />\n        </a-form-item>\n        <a-form-item\n          :labelCol=\"labelCol\"\n          :wrapperCol=\"wrapperCol\"\n          label=\"图片\">\n          <a-upload\n            listType=\"picture-card\"\n            class=\"avatar-uploader\"\n            :showUploadList=\"false\"\n            :supportServerRender=\"true\"\n            :customRequest=\"customRequest\"\n            :disabled=\"disableSubmit\"\n            v-decorator=\"['image',{ rules: [{ required: true, message: '图片不能为空' }] }]\"\n          >\n            <img v-if=\"coverimg\" :src=\"coverimg\" alt=\"avatar\" style=\"max-width: 150px;\" />\n            <div v-else>\n              <a-icon :type=\"loading ? 'loading' : 'plus'\" />\n              <div class=\"ant-upload-text\" v-if=\"!loading\">Upload</div>\n              <div class=\"ant-upload-text\" v-if=\"loading\">{{ percent }}%</div>\n            </div>\n          </a-upload>\n        </a-form-item>\n        <a-form-item\n          :labelCol=\"labelCol\"\n          :wrapperCol=\"wrapperCol\"\n          label=\"团长ID\">\n\t\t  <a-input v-if=\"autoSubmit\" placeholder=\"\" :disabled=\"autoSubmit\" :value=\"teamName\" />\n          <a-auto-complete\n\t\t\tv-else\n            class=\"global-search\"\n            @select=\"onSelect\"\n            @search=\"handleSearch\"\n            optionLabelProp=\"text\"\n            v-decorator=\"['userName',{ rules: [{ required: true, message: '请输入团长id' }] }]\"\n            placeholder=\"请输入团长id\"\n\t\t\t:disabled=\"autoSubmit\"\n          >\n            <template slot=\"dataSource\">\n              <a-select-option v-for=\"item in dataSource\" :key=\"item.nickName\" :text=\"item.nickName\" class=\"selece-option\">\n                <a-avatar :src=\"item.header\" :srcSet=\"item.header\" style=\"margin-right: 15px\"></a-avatar>\n                {{ item.nickName }}\n              </a-select-option>\n            </template>\n            <a-input class=\"associate_input\">\n              <a-button slot=\"suffix\" class=\"search-btn\" type=\"primary\" size=\"large\" @click=\"beginSearch\">\n                <a-icon type=\"search\"></a-icon>\n              </a-button>\n            </a-input>\n          </a-auto-complete>\n          \n        </a-form-item>\n        <a-form-item\n          :labelCol=\"labelCol\"\n          :wrapperCol=\"wrapperCol\"\n          label=\"团队人数\">\n          <a-input-number v-decorator=\"[ 'teamNum', {rules: [{ required: true, message: '团队人数不能为空' }]}]\" />\n        </a-form-item>\n        <a-form-item\n          :labelCol=\"labelCol\"\n          :wrapperCol=\"wrapperCol\"\n          label=\"大V团权益\">\n          <a-input placeholder=\"请输入大V团权益\" v-decorator=\"['descr', {}]\" />\n        </a-form-item>\n\t\t\n      </a-form>\n    </a-spin>\n  </a-modal>\n</template>\n\n<script>\n  import { httpAction, getAction} from '@/api/manage'\n  import Vue from 'vue'\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\";\n  import pick from 'lodash.pick'\n  import * as qiniu from 'qiniu-js'\n\n  export default {\n    name: \"BigTeamModal\",\n    data () {\n      return {\n        title:\"操作\",\n        visible: false,\n        headers: {},\n        loading: false,\n        coverimg: '',\n        canimg: '',\n        percent: '',\n        disableSubmit: false,\n\t\tautoSubmit: false,\n\t\tteamName: '',\n        model: {},\n        labelCol: {\n          xs: { span: 24 },\n          sm: { span: 5 },\n        },\n        wrapperCol: {\n          xs: { span: 24 },\n          sm: { span: 16 },\n        },\n        searchParam: '',    // 搜索字段\n        dataSource: [],     // 选择数据源\n        userId: null,\n        confirmLoading: false,\n        form: this.$form.createForm(this),\n        validatorRules:{\n        },\n        url: {\n          add: \"/system/bigteam/add\",\n          edit: \"/system/bigteam/edit\",\n          fileUpload: window._CONFIG['domianQiNiu'],\n          qiniuToken: '/qiniuUpToken',\n          searchUrl: '/system/appuserinfo/getUserBYPhoneOrCodeOrNickName'\n        },\n      }\n    },\n    computed:{\n      uploadAction:function () {\n        return this.url.fileUpload;\n      }\n    },\n    created () {\n      const token = Vue.ls.get(ACCESS_TOKEN);\n      this.headers = {\"X-Access-Token\":token};\n    },\n    methods: {\n      add () {\n        this.coverimg = '';\n\t\tthis.teamName = '';\n        this.edit({});\n      },\n      edit (record) {\n        console.log(record.name)\n\t\tif(record && record.name && record.name !== '' && record.name !== undefined) {\n\t\t\tthis.autoSubmit = true;\n\t\t\tconsole.log(this.autoSubmit)\n\t\t} else {\n\t\t\tthis.autoSubmit = false;\n\t\t\tconsole.log(this.autoSubmit);\n\t\t}\n\t\tthis.teamName = record.userName\n        this.coverimg = record.image;\n        this.canimg = record.image;\n        this.form.resetFields();\n        this.model = Object.assign({}, record);\n        this.visible = true;\n        this.$nextTick(() => {\n          this.form.setFieldsValue(pick(this.model,'name','image','userId','userName','teamNum','descr'))\n        });\n\n      },\n      close () {\n        this.$emit('close');\n        this.visible = false;\n        this.coverimg = '';\n        this.canimg = '';\n        this.percent = '';\n        this.dataSource = [];\n        this.searchParam = '';\n        this.disableSubmit = false;\n      },\n      handleOk () {\n        const that = this;\n        // 触发表单验证\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            that.confirmLoading = true;\n            let httpurl = '';\n            let method = '';\n            if(!this.model.id){\n              httpurl+=this.url.add;\n              method = 'post';\n            }else{\n              httpurl+=this.url.edit;\n               method = 'put';\n            }\n            let formData = Object.assign(this.model, values);\n               console.log('formData')\n          console.log(formData)\n            formData.image = this.coverimg;\n            formData.userId = this.userId;\n            //时间格式化\n            \n            console.log(formData)\n            httpAction(httpurl,formData,method).then((res)=>{\n              if(res.success){\n                that.$message.success(res.message);\n                that.$emit('ok');\n              }else{\n                that.$message.warning(res.message);\n              }\n            }).finally(() => {\n              that.confirmLoading = false;\n              that.close();\n            })\n\n\n\n          }\n        })\n      },\n      handleCancel () {\n        this.close()\n      },\n      // 自定义上传\n      customRequest (data) {\n        const suffix = \".\" + data.file.name.replace(/^.+\\./, '')\n        //请求token\n        httpAction(this.url.qiniuToken, {}, 'post').then((res) => {\n          if (res) {\n            let token = res.data.token\n            const file = data.file\n            const key = new Date().getTime() + suffix;\n            let domain = this.url.fileUpload\n            let config = {\n              useCdnDomain: true,\n              region: null\n            }\n            let putExtra = {\n              fname: '',\n              params: {},\n              mimeType: null\n            }\n            let observable = qiniu.upload(file, key, token, putExtra, config);\n            observable.subscribe({\n              next: (res) => {\n                this.loading = true;\n                this.percent = res.total.percent.toFixed(2)\n                this.coverimg = '';\n              },\n              error: () => {\n                this.$message.error('上传失败')\n                this.loading = false;\n                this.coverimg = this.canimg\n              },\n              complete: (response) => {\n                this.coverimg = `${domain}/${response.key}`;\n                this.loading = false;\n              }\n            })\n          }\n        })\n      },\n      //  输入选择框\n      onSelect (value) {\n        this.dataSource.forEach(item => {\n          if (item.nickName === value) {\n            this.userId = item.userId\n              console.log('this.userId')\n          console.log(this.userId)\n          }\n        })\n      },\n      handleSearch(value) {\n        console.log('search', value)\n        this.searchParam = value\n      },\n      //  开始搜索\n      beginSearch () {\n        getAction(this.url.searchUrl, {searchParam: this.searchParam}).then(res => {\n          console.log(res)\n          if (res.success) {\n            if (res.result.length === 0) {\n              this.$message.warning('暂无数据')\n            } else {\n              this.dataSource = res.result\n            }\n          } else {\n            this.$message.warning(res.message)\n          }\n        }).catch(err => {\n          this.$message.warning(err.message)\n        })\n      }\n    }\n  }\n</script>\n\n<style lang=\"less\">\n  .global-search .associate_input .ant-input-suffix {\n    right: 0 !important;\n  }\n  .global-search .ant-input-suffix .ant-btn-lg {\n    height: 32px;\n  }\n  .global-search .ant-input-affix-wrapper .ant-input:not(:last-child) {\n    padding: 0 50px 0 12px;\n  }\n  \n  .global-search.ant-select-auto-complete .ant-input-affix-wrapper .ant-input-suffix button {\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n  }\n  .selece-option {\n    padding: 10px 10px;\n    display: flex;\n    align-items: center;\n  }\n</style>"]}]}