{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\product\\modules\\ProductCategoryModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\product\\modules\\ProductCategoryModal.vue","mtime":1595326431241},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { putAction, postAction, httpAction, getAction } from \"@/api/manage\";\nimport pick from \"lodash.pick\";\nimport * as qiniu from \"qiniu-js\";\nexport default {\n  name: \"ProductCategoryModal\",\n  data() {\n    return {\n      imageUrl: \"\",\n      // canimg:\"\",\n      // upFatherId:1000,\n      title: \"操作\",\n      visible: false,\n      show: false,\n      model: {},\n      percent: \"\",\n      loading: false,\n      fatherid: undefined,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules: {},\n      url: {\n        add: \"/product/productCategory/add\",\n        edit: \"/product/productCategory/edit\",\n        fileUpload: window._CONFIG[\"domianQiNiu\"], // 七牛云地址\n        qiniuToken: \"/qiniuUpToken\" // 请求七牛云上传的token\n      }\n    };\n  },\n  created() {},\n  computed: {\n    uploadAction: function() {\n      return this.url.fileUpload;\n    }\n  },\n  methods: {\n    //父级节点选项重置\n    fatherIdReset() {\n      this.model.fatherId = this.fatherid;\n      this.$nextTick(() => {\n        this.form.setFieldsValue(pick(this.model, \"fatherId\"));\n      });\n    },\n    add() {\n      this.imageUrl = \"\";\n      this.percent = \"\";\n      this.confirmLoading = false;\n      this.edit({});\n    },\n    typeSelectHandle(value) {\n      if (value) {\n        this.show = true;\n      } else {\n        this.show = false;\n      }\n    },\n\n    edit(record) {\n      this.show = false;\n      this.imageUrl = record.imageUrl;\n      // this.canimg = record.imageUrl;\n      this.form.resetFields();\n      this.model = Object.assign({}, record);\n      this.fatherid = record.fatherId == 0 ? record.fatherId : undefined;\n      this.visible = true;\n      if (record.fatherId === 0) {\n        this.model.fatherId = \"\";\n      }\n      this.$nextTick(() => {\n        this.form.setFieldsValue(\n          pick(\n            this.model,\n            \"name\",\n            \"icon\",\n            \"fatherId\",\n            \"level\",\n            \"sorts\",\n            \"imageUrl\"\n          )\n        );\n      });\n    },\n    close() {\n      this.$emit(\"close\");\n      this.imageUrl = \"\";\n      this.percent = \"\";\n      this.visible = false;\n    },\n    // 图片自定义上传\n    imgCustomRequest(data) {\n      // 开始转圈圈，上传中\n      this.loading = true;\n      // 获取文件的后缀名\n      const suffix = \".\" + data.file.name.replace(/^.+\\./, \"\");\n      //请求token\n      httpAction(this.url.qiniuToken, {}, \"post\").then(res => {\n        if (res) {\n          let token = res.data.token;\n          const file = data.file;\n          const key = new Date().getTime() + suffix;\n          let domain = this.url.fileUpload;\n          let config = {\n            useCdnDomain: true, // 域名加速\n            region: null // 不指定具体区域，自动识别\n          };\n          let putExtra = {\n            fname: \"\",\n            params: {},\n            mimeType: null\n          };\n\n          let observable = qiniu.upload(file, key, token, putExtra, config);\n          observable.subscribe({\n            next: res => {\n              this.percent = res.total.percent.toFixed(2);\n              this.imageUrl = \"\";\n            },\n            error: () => {\n              this.$message.error(\"上传失败\");\n              this.loading = false;\n              // this.imageUrl = this.canimg;\n            },\n            complete: response => {\n              let allUrl = `${domain}/${response.key}`;\n              // 开始转圈圈，上传中\n              this.imageUrl = allUrl;\n              this.loading = false;\n            }\n          });\n        }\n      });\n    },\n    handleOk() {\n      const that = this;\n      // 触发表单验证\n      this.form.validateFields((err, values) => {\n        if (!err) {\n          that.confirmLoading = true;\n          let httpurl = \"\";\n          let method = \"\";\n          if (!this.model.id) {\n            httpurl += this.url.add;\n            method = \"post\";\n          } else {\n            httpurl += this.url.edit;\n            method = \"put\";\n          }\n          let formData = Object.assign(this.model, values);\n          formData.imageUrl = this.imageUrl;\n          formData.fatherId =\n            formData.fatherId != 0 ? formData.fatherId : undefined;\n          formData.level = !formData.fatherId ? 1 : 2;\n          //时间格式化\n\n          console.log(formData);\n          httpAction(httpurl, formData, method)\n            .then(res => {\n              if (res.success) {\n                that.$message.success(res.message);\n                that.$emit(\"ok\");\n              } else {\n                that.$message.warning(res.message);\n              }\n            })\n            .finally(() => {\n              that.confirmLoading = false;\n              that.close();\n            });\n        }\n      });\n    },\n\n    handleCancel() {\n      this.close();\n    }\n  }\n};\n",null]}