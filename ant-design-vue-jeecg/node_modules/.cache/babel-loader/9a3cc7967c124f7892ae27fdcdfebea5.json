{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js??ref--0-0!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\product\\modules\\ProductNewModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\product\\modules\\ProductNewModal.vue","mtime":1595310351602},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { httpAction, getAction } from '@/api/manage';\nimport pick from 'lodash.pick';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport JCodeEditor from \"@/components/jeecg/JCodeEditor\";\nimport JEditor from \"@/components/jeecg/JEditor\";\nimport AvatarModal from \"@/views/account/settings/AvatarModal\";\nimport ProductAddAlbumModal from \"./ProductAddAlbumModal\";\nimport * as qiniu from 'qiniu-js';\nexport default {\n  name: \"ProductNewModal\",\n  data: function data() {\n    return {\n      title: \"操作\",\n      visible: false,\n      model: {},\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 5\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 17\n        }\n      },\n      labelColk: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 2\n        }\n      },\n      wrapperColk: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 21\n        }\n      },\n      loading: false,\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      coverimg: '',\n      canimg: '',\n      percent: '',\n      refusereason: '',\n      disableSubmit: false,\n      albumList: [],\n      content: '',\n      headers: {},\n      selectList: [],\n      albumName: '',\n      //专辑名称\n      authorName: '',\n      //作者名称\n      validatorRules: {},\n      url: {\n        add: \"/product/productNew/add\",\n        edit: \"/product/productNew/edit\",\n        getbyId: '/product/productNew/queryById',\n        selectNewList: '/product/productCategory/queryFirstSelect',\n        //分类选择\n        albumlist: '/user/album/findAlbumSelect',\n        // 专辑\n        findList: '/product/productsource/findListByProductId',\n        // 课程资源详情\n        fileUpload: window._CONFIG['domianQiNiu'],\n        qiniuToken: '/qiniuUpToken'\n      }\n    };\n  },\n  components: {\n    JCodeEditor: JCodeEditor,\n    JEditor: JEditor,\n    AvatarModal: AvatarModal,\n    ProductAddAlbumModal: ProductAddAlbumModal\n  },\n  created: function created() {\n    var _this = this;\n\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    this.headers = {\n      \"X-Access-Token\": token\n    }; // this.getAblum()\n\n    getAction(this.url.selectNewList).then(function (res) {\n      if (res.success) {\n        _this.selectList = res.result;\n      } else {\n        _this.$message.warning(res.message);\n      }\n    });\n  },\n  computed: {\n    uploadAction: function uploadAction() {\n      return this.url.fileUpload;\n    }\n  },\n  methods: {\n    add: function add() {\n      this.coverimg = '';\n      this.refusereason = '';\n      this.content = '';\n      this.edit({});\n    },\n    edit: function edit(record) {\n      var _this2 = this;\n\n      console.log(record.id);\n      this.coverimg = record.coverimg;\n      this.canimg = record.coverimg;\n      this.form.resetFields(); // this.getAblum()\n\n      if (record.id) {\n        this.getNewModel(record.id, record.type);\n\n        if (record.type === '1' || record.type === '3') {\n          this.getContentModel(record.id);\n        }\n      } else {\n        this.model = Object.assign({}, record);\n        this.visible = true;\n        this.$nextTick(function () {\n          _this2.form.setFieldsValue(pick(_this2.model, 'title', 'introduction', 'fistcategory', 'coverimg', 'price'));\n        });\n      }\n    },\n    //获取课程专辑\n    getAblum: function getAblum() {\n      var _this3 = this;\n\n      httpAction(this.url.albumlist, {}, 'POST').then(function (res) {\n        if (res.success) {\n          _this3.albumList = res.result;\n        } else {\n          _this3.$message.warning(res.message);\n        }\n      });\n    },\n    // 根据id获取具体数据\n    getNewModel: function getNewModel(id, type) {\n      var _this4 = this;\n\n      var that = this;\n      getAction(this.url.getbyId, {\n        id: id\n      }).then(function (res) {\n        if (res.success) {\n          var record = res.result.product;\n          _this4.refusereason = record.refusereason;\n          _this4.albumName = res.result.albumName;\n          _this4.authorName = res.result.authorName;\n\n          if (type !== '1' && type !== '3') {\n            _this4.content = record.content;\n          }\n\n          _this4.model = Object.assign({}, record);\n          _this4.visible = true;\n\n          _this4.$nextTick(function () {\n            _this4.form.setFieldsValue(pick(_this4.model, 'title', 'introduction', 'fistcategory', 'coverimg', 'price'));\n          });\n        } else {\n          that.$message.warning(res.message);\n        }\n      });\n    },\n    //获取课程详情\n    getContentModel: function getContentModel(id) {\n      var _this5 = this;\n\n      var html = '';\n      var that = this;\n      getAction(this.url.findList, {\n        productId: id\n      }).then(function (res) {\n        if (res.success) {\n          var record = res.result;\n          html += '<div>';\n          record.forEach(function (item) {\n            if (item.title && item.title !== '') {\n              html += \"<strong style=\\\"margin-left: 100px;\\\">\".concat(item.title, \"</strong>\");\n            }\n\n            switch (item.type) {\n              case 'img':\n                html += \"<p><img src=\\\"\".concat(item.url, \"\\\" style=\\\"width:300px;\\\" /></p>\");\n                break;\n\n              case 'text':\n                html += \"<p style=\\\"text-indent: 2em;\\\">\".concat(item.url, \"</p>\");\n                break;\n\n              case 'video':\n                if (item.timeurl && item.timeurl !== '') {\n                  html += \"<a href=\\\"\".concat(item.url, \"\\\" target=\\\"_blank\\\" style=\\\"display:block;width:300px;height:150px;background-image:url(\").concat(item.timeurl, \");background-size: 100% auto;object-fit:cover;position:relative;\\\"><img src=\\\"\").concat(require('@assets/play.png'), \"\\\" alt=\\\"\\\" style=\\\"position: absolute;width: 50px;height: 50px;top: 50%;left: 50%;transform: translate(-50%,-50%);\\\"></a>\");\n                } else {\n                  html += \"<p><video controls=\\\"controls\\\" width=\\\"300\\\" height=\\\"150\\\"><source src=\\\"\".concat(item.url, \"\\\" /></video></p>\");\n                }\n\n                break;\n\n              case 'audio':\n                html += \"<p><audio src=\\\"\".concat(item.url, \"\\\" controls=\\\"controls\\\"></audio></p>\");\n                break;\n\n              default:\n                break;\n            }\n          });\n          html += '</div>';\n          _this5.content = html;\n          console.log(record);\n        } else {\n          that.$message.warning(res.message);\n        }\n      });\n    },\n    close: function close() {\n      this.$emit('close');\n      this.visible = false;\n      this.coverimg = '';\n      this.disableSubmit = false;\n      this.content = '';\n    },\n    handleOk: function handleOk() {\n      var _this6 = this;\n\n      var that = this; // 触发表单验证\n\n      this.form.validateFields(function (err, values) {\n        if (!err) {\n          that.confirmLoading = true;\n          var httpurl = '';\n          var method = '';\n\n          if (!_this6.model.id) {\n            httpurl += _this6.url.add;\n            method = 'post';\n          } else {\n            httpurl += _this6.url.edit;\n            method = 'put';\n          }\n\n          var formData = Object.assign(_this6.model, values);\n          formData.coverimg = _this6.coverimg;\n          formData.content = _this6.content; //时间格式化\n\n          console.log(formData);\n          httpAction(httpurl, formData, method).then(function (res) {\n            if (res.success) {\n              that.$message.success(res.message);\n              that.$emit('ok');\n            } else {\n              that.$message.warning(res.message);\n            }\n          }).finally(function () {\n            that.confirmLoading = false;\n            that.close();\n          });\n        }\n      });\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n    },\n    // 自定义上传\n    customRequest: function customRequest(data) {\n      var _this7 = this;\n\n      var suffix = \".\" + data.file.name.replace(/^.+\\./, ''); //请求token\n\n      httpAction(this.url.qiniuToken, {}, 'post').then(function (res) {\n        if (res) {\n          var token = res.data.token;\n          var file = data.file;\n          var key = new Date().getTime() + suffix;\n          var domain = _this7.url.fileUpload;\n          var config = {\n            useCdnDomain: true,\n            region: null\n          };\n          var putExtra = {\n            fname: '',\n            params: {},\n            mimeType: null\n          };\n          var observable = qiniu.upload(file, key, token, putExtra, config);\n          observable.subscribe({\n            next: function next(res) {\n              _this7.loading = true;\n              _this7.percent = res.total.percent.toFixed(2);\n              _this7.coverimg = '';\n            },\n            error: function error() {\n              _this7.$message.error('上传失败');\n\n              _this7.loading = false;\n              _this7.coverimg = _this7.canimg;\n            },\n            complete: function complete(response) {\n              _this7.coverimg = \"\".concat(domain, \"/\").concat(response.key);\n              _this7.loading = false;\n            }\n          });\n        }\n      });\n    },\n    addAlbum: function addAlbum() {\n      this.$refs.addAblumModal.add();\n      this.$refs.addAblumModal.visible = true;\n    },\n    modalFormOk: function modalFormOk() {\n      var _this8 = this;\n\n      httpAction(this.url.albumList, {}, 'POST').then(function (res) {\n        if (res.success) {\n          _this8.albumList = res.result;\n        } else {\n          _this8.$message.warning(res.message);\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["ProductNewModal.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <a-modal\n    :title=\"title\"\n    :width=\"1100\"\n    :visible=\"visible\"\n    :confirmLoading=\"confirmLoading\"\n    @ok=\"handleOk\"\n    @cancel=\"handleCancel\"\n    :footer=\"null\"\n    cancelText=\"关闭\"\n  >\n    \n    <a-spin :spinning=\"confirmLoading\">\n      <a-form :form=\"form\">\n        <a-row class=\"form-row\" :gutter=\"10\">\n          <a-col :lg=\"8\">\n            \n            <a-form-item\n              :labelCol=\"labelCol\"\n              :wrapperCol=\"wrapperCol\"\n              label=\"课程标题\">\n              <a-input placeholder=\"请输入课程标题\" v-decorator=\"['title', {}]\" :readOnly=\"disableSubmit\"/>\n            </a-form-item>\n          </a-col>\n          <a-col :lg=\"8\">\n            <a-form-item\n              :labelCol=\"labelCol\"\n              :wrapperCol=\"wrapperCol\"\n              label=\"课程分类\">\n              <a-select placeholder=\"请选择课程分类\" v-decorator=\"['fistcategory', {}]\" :disabled=\"disableSubmit\">\n                <a-select-option v-for=\"(item, index) in selectList\" :key=\"index\" :value=\"item.id\">{{ item.name }}</a-select-option>\n              </a-select>\n            </a-form-item>\n          </a-col>\n          <a-col :lg=\"8\">\n            <a-form-item\n              :labelCol=\"labelCol\"\n              :wrapperCol=\"wrapperCol\"\n              label=\"课程专辑\">\n              <a-input placeholder=\"\" v-model=\"albumName\" :readOnly=\"disableSubmit\" />\n            </a-form-item>\n          </a-col>\n          <a-col :lg=\"8\">\n            <a-form-item\n              :labelCol=\"labelCol\"\n              :wrapperCol=\"wrapperCol\"\n              label=\"课程作者\">\n              <a-input placeholder=\"\" v-model=\"authorName\" :readOnly=\"disableSubmit\" />\n            </a-form-item>\n          </a-col>\n          <a-col :lg=\"8\">\n            <a-form-item\n              :labelCol=\"labelCol\"\n              :wrapperCol=\"wrapperCol\"\n              label=\"课程价格\">\n              <a-input placeholder=\"\" v-decorator=\"['price', {}]\" :readOnly=\"disableSubmit\" />\n            </a-form-item>\n          </a-col>\n          <a-col :lg=\"24\">\n            <a-form-item\n              :labelCol=\"labelColk\"\n              :wrapperCol=\"wrapperColk\"\n              label=\"课程简介\">\n              <a-input placeholder=\"请输入课程简介\" v-decorator=\"['introduction', {} ]\" :readOnly=\"disableSubmit\" />\n            </a-form-item>\n          </a-col>\n          \n          <a-col :lg=\"24\" v-show=\"disableSubmit\">\n            <a-form-item\n              :labelCol=\"labelColk\"\n              :wrapperCol=\"wrapperColk\"\n              label=\"课程详情\">\n              <div v-html=\"content\" style=\"border: 1px solid #ccc;padding: 20px;border-radius: 5px;\"></div>\n            </a-form-item>\n          </a-col>\n        \n        </a-row>\n        <a-form-item\n          :labelCol=\"labelColk\"\n          :wrapperCol=\"wrapperColk\"\n          label=\"课程详情\"\n          v-show=\"!disableSubmit\">\n          <j-editor v-model=\"content\" :disabled=\"disableSubmit\"></j-editor>\n        </a-form-item>\n        <a-form-item label=\"课程封面\" :labelCol=\"labelColk\" :wrapperCol=\"wrapperColk\">\n          <a-upload\n            listType=\"picture-card\"\n            class=\"avatar-uploader\"\n            :showUploadList=\"false\"\n            :supportServerRender=\"true\"\n            :customRequest=\"customRequest\"\n            :disabled=\"disableSubmit\"\n          >\n            <img v-if=\"coverimg\" :src=\"coverimg\" alt=\"avatar\" style=\"max-width: 150px;\" />\n            <div v-else>\n              <a-icon :type=\"loading ? 'loading' : 'plus'\" />\n              <div class=\"ant-upload-text\" v-if=\"!loading\">Upload</div>\n              <div class=\"ant-upload-text\" v-if=\"loading\">{{ percent }}%</div>\n            </div>\n          </a-upload>\n        \n        </a-form-item>\n        \n        <a-form-item label=\"拒绝理由\" :labelCol=\"labelColk\" :wrapperCol=\"wrapperColk\" v-if=\"refusereason\">\n          <a-textarea v-model=\"refusereason\" :autosize=\"{ minRows: 3, maxRows: 8 }\" :readOnly=\"true\"/>\n        </a-form-item>\n        \n        \n        <!-- <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"点击次数\">\n            <a-input-number v-decorator=\"[ 'clickcount', {}]\" />\n          </a-form-item>\n          <a-form-item\n            :labelCol=\"labelCol\"\n            :wrapperCol=\"wrapperCol\"\n            label=\"点赞次数\">\n            <a-input-number v-decorator=\"[ 'topcount', {}]\" />\n          </a-form-item> -->\n      \n      </a-form>\n    </a-spin>\n    <avatar-modal ref=\"modal\"></avatar-modal>\n    <product-add-album-modal ref=\"addAblumModal\" @ok=\"modalFormOk\"></product-add-album-modal>\n  </a-modal>\n</template>\n\n<script>\n  import Vue from 'vue'\n  import { httpAction, getAction } from '@/api/manage'\n  import pick from 'lodash.pick'\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\"\n  import JCodeEditor from \"@/components/jeecg/JCodeEditor\"\n  import JEditor from \"@/components/jeecg/JEditor\"\n  import AvatarModal from \"@/views/account/settings/AvatarModal\";\n  import ProductAddAlbumModal from \"./ProductAddAlbumModal\";\n  import * as qiniu from 'qiniu-js'\n\n  export default {\n    name: \"ProductNewModal\",\n    data () {\n      return {\n        title:\"操作\",\n        visible: false,\n        model: {},\n        labelCol: {\n          xs: { span: 24 },\n          sm: { span: 5 },\n        },\n        wrapperCol: {\n          xs: { span: 24 },\n          sm: { span: 17 },\n        },\n        labelColk: {\n          xs: { span: 24 },\n          sm: { span: 2 },\n        },\n        wrapperColk: {\n          xs: { span: 24 },\n          sm: { span: 21 },\n        },\n        loading: false,\n        confirmLoading: false,\n        form: this.$form.createForm(this),\n        coverimg: '',\n        canimg: '',\n        percent: '',\n        refusereason: '',\n        disableSubmit: false,\n        albumList: [],\n        content: '',\n        headers: {},\n        selectList: [],\n        albumName: '',    //专辑名称\n        authorName: '',   //作者名称\n        validatorRules:{\n        },\n        url: {\n          add: \"/product/productNew/add\",\n          edit: \"/product/productNew/edit\",\n          getbyId: '/product/productNew/queryById',\n          selectNewList: '/product/productCategory/queryFirstSelect',   //分类选择\n          albumlist: '/user/album/findAlbumSelect',    // 专辑\n          findList: '/product/productsource/findListByProductId',    // 课程资源详情\n          fileUpload: window._CONFIG['domianQiNiu'],\n          qiniuToken: '/qiniuUpToken'\n        },\n      }\n    },\n    components: {\n      JCodeEditor,\n      JEditor,\n      AvatarModal,\n      ProductAddAlbumModal\n    },\n    created () {\n      const token = Vue.ls.get(ACCESS_TOKEN);\n      this.headers = {\"X-Access-Token\":token};\n      // this.getAblum()\n      getAction(this.url.selectNewList).then((res) => {\n        if (res.success) {\n          this.selectList = res.result;\n        } else {\n          this.$message.warning(res.message);\n        }\n      })\n    },\n    computed:{\n      uploadAction:function () {\n        return this.url.fileUpload;\n      }\n    },\n    methods: {\n      add () {\n        this.coverimg = '';\n        this.refusereason = '';\n        this.content = '';\n        this.edit({});\n      },\n      edit (record) {\n        console.log(record.id)\n        this.coverimg = record.coverimg;\n        this.canimg = record.coverimg;\n        this.form.resetFields();\n        // this.getAblum()\n        if(record.id) {\n          this.getNewModel (record.id, record.type);\n          if (record.type === '1' || record.type === '3') {\n            this.getContentModel (record.id)\n          }\n        } else {\n          this.model = Object.assign({}, record);\n          this.visible = true;\n          this.$nextTick(() => {\n            this.form.setFieldsValue(pick(this.model,'title','introduction','fistcategory', 'coverimg', 'price'))\n          });\n        }\n      },\n      //获取课程专辑\n      getAblum() {\n        httpAction(this.url.albumlist, {}, 'POST').then(res => {\n          if (res.success) {\n            this.albumList = res.result\n          } else {\n            this.$message.warning(res.message)\n          }\n        })\n      },\n      // 根据id获取具体数据\n      getNewModel (id, type) {\n        const that = this;\n        getAction(this.url.getbyId,{id: id}).then((res) => {\n          if(res.success){\n            let record = res.result.product;\n            this.refusereason = record.refusereason;\n            this.albumName = res.result.albumName;\n            this.authorName = res.result.authorName;\n            if (type !== '1' && type !== '3') {\n              this.content = record.content;\n            }\n            this.model = Object.assign({}, record);\n            this.visible = true;\n            this.$nextTick(() => {\n              this.form.setFieldsValue(pick(this.model,'title','introduction','fistcategory','coverimg', 'price'))\n            });\n          }else{\n            that.$message.warning(res.message);\n          }\n        })\n      },\n      //获取课程详情\n      getContentModel (id) {\n        let html = '';\n        const that = this;\n        getAction(this.url.findList,{productId: id}).then((res) => {\n          if(res.success){\n            let record = res.result;\n            html += '<div>';\n            record.forEach(item => {\n              if (item.title && item.title !== '') {\n                html += `<strong style=\"margin-left: 100px;\">${item.title}</strong>`\n              }\n              switch (item.type) {\n                case 'img':\n                  html += `<p><img src=\"${item.url}\" style=\"width:300px;\" /></p>`;\n                  break;\n                case 'text':\n                  html += `<p style=\"text-indent: 2em;\">${item.url}</p>`;\n                  break;\n                case 'video':\n\n                  if(item.timeurl && item.timeurl !== '') {\n                    html += `<a href=\"${item.url}\" target=\"_blank\" style=\"display:block;width:300px;height:150px;background-image:url(${item.timeurl});background-size: 100% auto;object-fit:cover;position:relative;\"><img src=\"${require('@assets/play.png')}\" alt=\"\" style=\"position: absolute;width: 50px;height: 50px;top: 50%;left: 50%;transform: translate(-50%,-50%);\"></a>`\n                  } else {\n                    html += `<p><video controls=\"controls\" width=\"300\" height=\"150\"><source src=\"${item.url}\" /></video></p>`;\n                  }\n                  \n                  break;\n                case 'audio':\n                  html += `<p><audio src=\"${item.url}\" controls=\"controls\"></audio></p>`;\n                  break;\n                default:\n                  break\n              }\n            });\n            html += '</div>';\n            this.content = html;\n            console.log(record)\n          }else{\n            that.$message.warning(res.message);\n          }\n        })\n      },\n      close () {\n        this.$emit('close');\n        this.visible = false;\n        this.coverimg = '';\n        this.disableSubmit = false;\n        this.content = '';\n      },\n      handleOk () {\n        const that = this;\n        // 触发表单验证\n        this.form.validateFields((err, values) => {\n          if (!err) {\n            that.confirmLoading = true;\n            let httpurl = '';\n            let method = '';\n            if(!this.model.id){\n              httpurl+=this.url.add;\n              method = 'post';\n            }else{\n              httpurl+=this.url.edit;\n              method = 'put';\n            }\n            let formData = Object.assign(this.model, values);\n            formData.coverimg = this.coverimg;\n            formData.content = this.content;\n            //时间格式化\n\n            console.log(formData)\n            httpAction(httpurl,formData,method).then((res)=>{\n              if(res.success){\n                that.$message.success(res.message);\n                that.$emit('ok');\n              }else{\n                that.$message.warning(res.message);\n              }\n            }).finally(() => {\n              that.confirmLoading = false;\n              that.close();\n            })\n          }\n        })\n      },\n      handleCancel () {\n        this.close()\n      },\n      // 自定义上传\n      customRequest (data) {\n        const suffix = \".\" + data.file.name.replace(/^.+\\./, '')\n        //请求token\n        httpAction(this.url.qiniuToken, {}, 'post').then((res) => {\n          if (res) {\n            let token = res.data.token\n            const file = data.file\n            const key = new Date().getTime() + suffix;\n            let domain = this.url.fileUpload\n            let config = {\n              useCdnDomain: true,\n              region: null\n            }\n            let putExtra = {\n              fname: '',\n              params: {},\n              mimeType: null\n            }\n            let observable = qiniu.upload(file, key, token, putExtra, config);\n            observable.subscribe({\n              next: (res) => {\n                this.loading = true;\n                this.percent = res.total.percent.toFixed(2)\n                this.coverimg = '';\n              },\n              error: () => {\n                this.$message.error('上传失败')\n                this.loading = false;\n                this.coverimg = this.canimg\n              },\n              complete: (response) => {\n                this.coverimg = `${domain}/${response.key}`;\n                this.loading = false;\n              }\n            })\n          }\n        })\n      },\n      addAlbum () {\n        this.$refs.addAblumModal.add()\n        this.$refs.addAblumModal.visible = true\n      },\n      modalFormOk () {\n        httpAction(this.url.albumList, {}, 'POST').then(res => {\n          if (res.success) {\n            this.albumList = res.result\n          } else {\n            this.$message.warning(res.message)\n          }\n        })\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  \n  .avatar-uploader > .ant-upload {\n    width: 128px;\n    height: 128px;\n  }\n  .ant-upload-select-picture-card i {\n    font-size: 32px;\n    color: #999;\n  }\n  \n  .ant-upload-select-picture-card .ant-upload-text {\n    margin-top: 8px;\n    color: #666;\n  }\n\n</style>\n"],"sourceRoot":"src/views/product/modules"}]}