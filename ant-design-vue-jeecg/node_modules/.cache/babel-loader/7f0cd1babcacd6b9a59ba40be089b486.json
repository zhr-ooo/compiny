{"remainingRequest":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_thread-loader@2.1.3@thread-loader\\dist\\cjs.js!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js??ref--0-0!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js??vue-loader-options!E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\liveplayer\\modules\\InformationModals.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\src\\views\\liveplayer\\modules\\InformationModals.vue","mtime":1593671126486},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_thread-loader@2.1.3@thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\gitweb\\vcloudsapce_web\\ant-design-vue-jeecg\\node_modules\\_vue-loader@15.9.2@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from \"vue\";\nimport JCodeEditor from \"@/components/jeecg/JCodeEditor\";\nimport JEditor from \"@/components/jeecg/JEditor\";\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport { putAction, postAction, httpAction, getAction } from \"@/api/manage\";\nimport pick from \"lodash.pick\";\nimport * as qiniu from \"qiniu-js\";\nexport default {\n  name: \"InformationModals\",\n  data: function data() {\n    return {\n      source: 1,\n      userId: null,\n      autoSubmit: false,\n      contentList: [],\n      visible: false,\n      content: '',\n      icon: \"\",\n      dataSource: [],\n      model: {},\n      loading: false,\n      title: \"新增\",\n      labelCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 5\n        }\n      },\n      wrapperCol: {\n        xs: {\n          span: 24\n        },\n        sm: {\n          span: 16\n        }\n      },\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules: {},\n      url: {\n        add: \"/system/mall/goods/add\",\n        edit: \"/system/mall/goods/update\",\n        //修改问题分类,\n        searchUrl: \"/system/appuserinfo/getUserBYPhoneOrCodeOrNickName\",\n        fileUpload: window._CONFIG[\"domianQiNiu\"],\n        // 七牛云地址\n        qiniuToken: \"/qiniuUpToken\",\n        // 请求七牛云上传的token\n        getbyId: \"/system/mall/goods/findListByGoodId\"\n      },\n      components: {\n        JCodeEditor: JCodeEditor,\n        JEditor: JEditor\n      }\n    };\n  },\n  created: function created() {\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    this.headers = {\n      \"X-Access-Token\": token\n    };\n  },\n  computed: {\n    uploadAction: function uploadAction() {\n      return this.url.fileUpload;\n    }\n  },\n  methods: {\n    add: function add() {\n      this.icon = \"\";\n      this.percent = \"\";\n      this.content = '';\n      this.confirmLoading = false;\n      this.edit({});\n    },\n    // 删除数据\n    delHandle: function delHandle(index) {\n      if (!index) {\n        this.contentList.splice(0, 1);\n      } else {\n        this.contentList.splice(index, 1);\n      }\n\n      this.$forceUpdate();\n    },\n    edit: function edit(record) {\n      var _this = this;\n\n      this.contentList = [];\n      this.isId = record.id;\n      console.log(this.contentList);\n\n      if (record && record.id && record.id !== \"\") {\n        this.autoSubmit = true;\n        this.getContentModel(record.id);\n      } else {\n        this.autoSubmit = false;\n      }\n\n      this.icon = record.icon;\n      this.canimg = record.icon;\n      this.form.resetFields();\n      this.model = Object.assign({}, record);\n      this.visible = true;\n      this.$nextTick(function () {\n        _this.form.setFieldsValue(pick(_this.model, \"name\", \"money\", \"stock\", \"userId\", \"source\", \"firstRebate\", \"secondRebate\", \"shelvesState\"));\n      });\n    },\n    //获取课程详情\n    getContentModel: function getContentModel(id) {\n      var _this2 = this;\n\n      var that = this;\n      getAction(this.url.getbyId, {\n        goodId: id\n      }).then(function (res) {\n        if (res.success) {\n          var record = res.result;\n\n          if (record.length > 0) {\n            _this2.contentList = res.result;\n\n            _this2.$forceUpdate();\n          } else {\n            setTimeout(function () {\n              that.makeEdit();\n            }, 500);\n          }\n\n          console.log(record);\n        } else {\n          that.$message.warning(res.message);\n        }\n      });\n    },\n    // 文件自定义上传\n    fileCustomRequest: function fileCustomRequest(data) {\n      var _this3 = this;\n\n      // 上传文件的类型\n      var fileType = data.file.type;\n      this.confirmLoading = true; // 获取文件的后缀名\n\n      var suffix = \".\" + data.file.name.replace(/^.+\\./, \"\"); //请求token\n\n      httpAction(this.url.qiniuToken, {}, \"post\").then(function (res) {\n        if (res) {\n          var token = res.data.token;\n          var file = data.file;\n          var key = new Date().getTime() + suffix;\n          var domain = _this3.url.fileUpload;\n          var config = {\n            useCdnDomain: true,\n            // 域名加速\n            region: null // 不指定具体区域，自动识别\n\n          };\n          var putExtra = {\n            fname: \"\",\n            params: {},\n            mimeType: null\n          };\n          var observable = qiniu.upload(file, key, token, putExtra, config);\n          observable.subscribe({\n            next: function next(res) {\n              var thisPercent = res.total.percent.toFixed(2);\n              _this3.filePercent = thisPercent + \"%\";\n            },\n            error: function error() {\n              _this3.$message.error(\"上传失败\");\n\n              _this3.confirmLoading = false;\n              _this3.filePercent = \"\";\n            },\n            complete: function complete(response) {\n              var allUrl = \"\".concat(domain, \"/\").concat(response.key); //  否则为视频资源\n\n              var coverimg = allUrl;\n              var dataCon = {\n                type: _this3.thisType,\n                timeurl: \"\",\n                title: \"\",\n                url: coverimg\n              };\n\n              _this3.contentList.splice(_this3.thisIndex, 0, dataCon);\n\n              _this3.$forceUpdate();\n\n              _this3.confirmLoading = false;\n              _this3.filePercent = \"\";\n            }\n          });\n        }\n      });\n    },\n    changeIndex: function changeIndex(index) {\n      this.thisIndex = index;\n      console.log(this.thisIndex);\n    },\n    onSelect: function onSelect(value) {\n      var _this4 = this;\n\n      this.dataSource.forEach(function (item) {\n        if (item.userId === Number(value)) {\n          _this4.userId = value;\n        }\n      });\n    },\n    handleSearch: function handleSearch(value) {\n      //   console.log(\"search\", value);\n      this.searchParam = value;\n    },\n    //  开始搜索\n    beginSearch: function beginSearch() {\n      var _this5 = this;\n\n      getAction(this.url.searchUrl, {\n        searchParam: this.searchParam\n      }).then(function (res) {\n        if (res.success) {\n          if (res.result.length === 0) {\n            _this5.$message.warning(\"暂无数据\");\n          } else {\n            _this5.dataSource = res.result;\n          }\n        } else {\n          _this5.$message.warning(res.message);\n        }\n      }).catch(function (err) {\n        _this5.$message.warning(err.message);\n      });\n    },\n    makeKu: function makeKu(rule, value, callback) {\n      var re = /^-[0-9]*[1-9][0-9]*$/;\n\n      if (re.test(value)) {\n        callback(\"库存必须大于0\");\n      } else {\n        callback();\n      }\n    },\n    // makeLength(rule, value, callback) {\n    //   if (value.length > 10) {\n    //     callback(\"输入字符限制，请重新输入\");\n    //   } else {\n    //     callback();\n    //   }\n    // },\n    makeMax: function makeMax(rule, value, callback) {\n      if (value.length > 8) {\n        callback(\"商品价格最大支持八位\");\n      } else {\n        callback();\n      }\n    },\n    makeNumber: function makeNumber(rule, value, callback) {\n      var re = /^([1-9]\\d*|[0]{1,1})$/; // var re = '^[0-9]*[1-9][0-9]*$';\n\n      if (!re.test(value)) {\n        callback(\"请输入正整数\");\n      } else {\n        callback();\n      }\n    },\n    close: function close() {\n      this.$emit(\"close\");\n      this.visible = false;\n      this.dataSource = [];\n      this.contentList = '';\n    },\n    // 图片自定义上传\n    makeEdit: function makeEdit() {\n      var _this6 = this;\n\n      // 判断详情类型\n      var record = this.record;\n      var thisHtml = \"\";\n      var typeImgs = [];\n      typeImgs = record.images.split(\";\");\n\n      for (var i = 0; i < typeImgs.length; i++) {\n        thisHtml = \"<p><img src=\\\"\".concat(typeImgs[i], \"\\\" /></p>\");\n      }\n\n      this.source = thisHtml;\n      this.model = Object.assign({}, record);\n      this.$nextTick(function () {\n        _this6.form.setFieldsValue(pick(_this6.model, \"name\", \"money\", \"stock\", \"userId\", \"source\", \"firstRebate\", \"secondRebate\"));\n      });\n    },\n    handleOk: function handleOk() {\n      var _this7 = this;\n\n      if (!this.isId && !this.userId) {\n        alert(\"请选择用户\");\n        return;\n      }\n\n      var that = this; // 触发表单验证\n\n      this.form.validateFields(function (err, values) {\n        if (!err) {\n          that.confirmLoading = true;\n          var httpurl = \"\";\n          var allData = {};\n          var formData = Object.assign(_this7.model, values);\n          formData.icon = _this7.icon;\n          var source = JSON.stringify(_this7.contentList);\n          console.log(source);\n          allData.goods = formData;\n          allData.source = source;\n\n          if (_this7.contentList.length > 0) {\n            // httpurl+='?source='+source;\n            formData.content = \"\";\n          } else {\n            // httpurl+=\"?source=\";\n            formData.content = _this7.content;\n          }\n\n          if (!_this7.model.id) {\n            httpurl += _this7.url.add;\n            postAction(httpurl, allData).then(function (res) {\n              if (res.success) {\n                that.$message.success(res.message);\n                that.$emit(\"ok\");\n              } else {\n                that.$message.warning(res.message);\n              }\n            }).finally(function () {\n              that.confirmLoading = false;\n              that.close();\n            });\n          } else {\n            httpurl += _this7.url.edit; // let arr = `?name=${formData.name}&icon=${formData.icon}&phone=${formData.phone}`;\n\n            putAction(httpurl, allData).then(function (res) {\n              if (res.success) {\n                that.$message.success(res.message);\n                that.$emit(\"ok\");\n              } else {\n                that.$message.warning(res.message);\n              }\n            }).finally(function () {\n              that.confirmLoading = false;\n              that.close();\n            });\n          }\n        }\n      });\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n    }\n  }\n};",null]}